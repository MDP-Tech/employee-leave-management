<!DOCTYPE html>
<html lang="en" data-layout="topnav" data-topbar-color="light" data-menu-color="dark">

<head>
    <meta charset="utf-8" />
    <title>Apply Leave Page | Shiftwave</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
    <meta content="A fully responsive admin theme which can be used to build CRM, CMS,ERP etc." name="description" />
    <meta content="Techzaa" name="author" />

    <!-- App favicon -->
    <link rel="shortcut icon" href="/assets/images/favicon.ico">

    <!-- Daterangepicker css -->
    <link rel="stylesheet" href="/assets/vendor/daterangepicker/daterangepicker.css">

    <!-- Vector Map css -->
    <link rel="stylesheet" href="/assets/vendor/admin-resources/jquery.vectormap/jquery-jvectormap-1.2.2.css">

    <!-- Theme Config Js -->
    <script src="/assets/js/config.js"></script>

    <!-- App css -->
    <link href="/assets/css/app.min.css" rel="stylesheet" type="text/css" id="app-style" />

    <!-- Datatables css -->
    <link href="/assets/vendor/datatables.net-bs5/css/dataTables.bootstrap5.min.css" rel="stylesheet" type="text/css" />
    <link href="/assets/vendor/datatables.net-responsive-bs5/css/responsive.bootstrap5.min.css" rel="stylesheet"
        type="text/css" />
    <link href="/assets/vendor/datatables.net-fixedcolumns-bs5/css/fixedColumns.bootstrap5.min.css" rel="stylesheet"
        type="text/css" />
    <link href="/assets/vendor/datatables.net-fixedheader-bs5/css/fixedHeader.bootstrap5.min.css" rel="stylesheet"
        type="text/css" />
    <link href="/assets/vendor/datatables.net-buttons-bs5/css/buttons.bootstrap5.min.css" rel="stylesheet"
        type="text/css" />
    <link href="/assets/vendor/datatables.net-select-bs5/css/select.bootstrap5.min.css" rel="stylesheet"
        type="text/css" />
  <!-- Icons css -->
  <link href="/assets/css/icons.min.css" rel="stylesheet" type="text/css" />

  
    <style>
        div.scroll {
            margin: 4px;
            padding: 4px;
            overflow-x: auto;
            white-space: nowrap;
        }
        .lead-table1 {
         overflow-y: hidden;
         }

      .table-responsive1 {
       overflow-x: auto;
       }
        .white-background {
            background-color: white;
        }

        .head-fp {
            margin: 5px auto;
            font-weight: 900;
        }

        .address-hr.biography.updateFields {
            border-bottom: 1px solid #efefef;
            padding: 8px 0;
        }

        .sp {
            margin: 5px 0px;
        }

        .tp {
            margin: 0px;
        }
        .fp{
            margin: 5px 0px;
        }

        .sub-btn-style {
            height: 35px;
            width: 80px;
        }

        .set-button-action1{
            
            text-align: center;
            justify-content: center;
            align-items: center;
            display: flex;
            margin: auto;
        }
        .image-container-file-upload {
        display: flex;
        flex-wrap: wrap;
        justify-content: flex-start;
    }

    .image-container-file-upload a {
        text-decoration: none;
    }

    .image-container-file-upload p {
        margin: 0;
    }

    .image-container-file-upload img {
        /* width: 85%;
        height: 75px;
        margin-right: 10px;	
        margin-bottom: 10px;
        border: 0.1px rgb(233 233 233) solid; */
    width: 100%; /* Adjust based on your design */
    max-width: 100px; /* Set a maximum width if needed */
    height: 75px; /* Maintain aspect ratio */
    margin-right: 10px;	
    margin-bottom: 10px;
    border: 0.1px solid rgb(233, 233, 233);
    }

 </style>


  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- Bootstrap JS -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
        
   
</head>

<body>
   
    <!-- Begin page -->
 
<!-- Begin page -->
 
<div class="wrapper">

      
    <%- include('../includes/admin-header')%>


        <!-- ============================================================== -->
        <!-- Start Page Content here -->
        <!-- ============================================================== -->

        <div class="content-page">
            <div class="content">

                <!-- Start Content-->
                <div class="container-fluid">

                    <!-- start page title -->
                    <div class="row">
                        <div class="col-12">
                            <div class="page-title-box">
                                <div class="page-title-right">
                                    <ol class="breadcrumb m-0">
                                        <a ><input  type="button" value="Delete Leave" class="btn btn-primary btn-sm waves-effect waves-light delete_button" style="margin-right:2px ;"></a> 
                                        <a href="javascript:window.history.go(-1);"><input type="button" value="Back" class="btn btn-primary btn-sm waves-effect waves-light"></a>
                                    </ol>
                                </div>
                                <% if(id == 1){ %>
                                <h4 class="page-title">Leave Details</h4>
                                <% } else { %>
                                <h4 class="page-title">Permission Details</h4>
                                <% } %>
                            </div>
                        </div>
                    </div>
                    <!-- end page title -->

                    <div class="row" id="table_data">
                        
                        <!-- Striped table start -->
                        <div>
                            <div class="alert alert-danger alert-dismissible fade show" style="display: none;"
                                id="failed_message"><strong>Info: </strong>
                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                    <span aria-hidden="false">&times;</span>
                                </button>

                            </div>
                            <div class="alert alert-success alert-dismissible fade show" id="sucess_message"
                                style="display: none;"><strong>Info: </strong>
                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="card">
                                <div class="card-body">
                                    
                                       
                                            <table>
                                              <div>
                                                <% if(id == 1){ %>
                                                    
                                                <tbody>

                                                    <% result.forEach(leave=> { %>

                                                       <div class="row">
                                                        <div class="col-md-3">
                                                            <div class="address-hr biography updateFields">
                                                                <p class="head-fp">Request Id:
                                                                </p>
                                                                <p class="sp"  value="<%= leave.request_id %>" id="req_id"><%= leave.request_id %></p>
                                                                <p class="tp" style="display:none"></p>
                                                            </div>
                                                         </div>
                                                        <div class="col-md-3">
                                                            <div class="address-hr biography updateFields">
                                                                <p class="head-fp">Employee Name: </p>
                                                                <p class="sp" id="employee_name"><%= leave.fullname %> </p>
                                                                <p class="tp" style="display:none"></p>
                                                           </div>                               
                                                        </div>
                                                       
                                                        <div class="col-md-3">
                                                            <div class="address-hr biography updateFields">
                                                                <p class="head-fp">Employee Email:
                                                                </p>
                                                                <p class="sp" id="email"> <%= leave.email %></p>
                                                                <p class="tp" style="display:none"></p>
                                                            </div>
                                                         </div>
                                                         <div class="col-md-3">
                                                            <div class="address-hr biography updateFields">
                                                                <p class="head-fp">Employee id:
                                                                </p>
                                                                <p class="sp"  id="employee_id"><a
                                                                  
                                                                    target="_blank">
                                                                    <%= leave.employee_id %>
                                                                </a></p>
                                                                <p class="tp" style="display:none"></p>
                                                            </div>
                                                         </div>
                                                        
                                                         <div class="col-md-3">
                                                            <div class="address-hr biography updateFields">
                                                                <p class="head-fp">Leave Type:
                                                                </p>
                                                                <p class="fp" id="updateShow-119"> <%= leave.leave_type %></p>
                                                                <p class="tp" style="display:none"></p>
                                                            </div>
                                                         </div>
                                                         
                                                         <div class="col-md-3">
                                                            <div class="address-hr biography updateFields">
                                                                <p class="head-fp">Leave From:
                                                                </p>
                                                                <p class="fp from_date" id="updateShow-119"> <%
                                                                    const date = new Date(leave.start_date);
                                                                    const day = date.getDate().toString().padStart(2, '0');
                                                                    const month = (date.getMonth() + 1).toString().padStart(2, '0');
                                                                    const year = date.getFullYear();
                                                                    const start_date = `${day}-${month}-${year}`;
                                                                  %>
                                                                  
                                                                  <%= start_date %>
                                                                  </p>
                                                                <p class="tp" style="display:none"></p>
                                                            </div>
                                                         </div>
                                                         <div class="col-md-3">
                                                            <div class="address-hr biography updateFields">
                                                                <p class="head-fp">Leave Upto:
                                                                </p>
                                                                <p class="fp to_date" id="updateShow-119"><%
                                                                    const date1 = new Date(leave.end_date);
                                                                    const day1 = date1.getDate().toString().padStart(2, '0');
                                                                    const month1 = (date1.getMonth() + 1).toString().padStart(2, '0');
                                                                    const year1 = date1.getFullYear();
                                                                    const end_date = `${day1}-${month1}-${year1}`;
                                                                  %>
                                                                  
                                                                  <%= end_date %>
                                                                  </p>
                                                                <p class="tp" style="display:none"></p>
                                                            </div>
                                                         </div>
                                                         <div class="col-md-3">
                                                            <div class="address-hr biography updateFields">
                                                                <p class="head-fp">Leave Applied:
                                                                </p>
                                                                <p class="fp" id="updateShow-119"><%
                                                                    const date2 = new Date(leave.created_at);
                                                                    const day2 = date2.getDate().toString().padStart(2, '0');
                                                                    const month2 = (date2.getMonth() + 1).toString().padStart(2, '0');
                                                                    const year2 = date2.getFullYear();
                                                                    const created_at = `${day2}-${month2}-${year2}`;
                                                                  %>
                                                                  
                                                                  <%= created_at %>
                                                                  </p>
                                                                <p class="tp" style="display:none"></p>
                                                            </div>
                                                         </div>
                                                         <div class="col-md-3">
                                                            <div class="address-hr biography updateFields">
                                                                <p class="head-fp">Days
                                                                </p>
                                                                <p class="fp" id="days"><%= leave.no_of_days %>  <%= leave.half_day_leave %></p>
                                                                
                                                            </div>
                                                         </div>
                                                    
                                                         <div class="col-md-3">
                                                            <div class="address-hr biography updateFields">
                                                                <p class="head-fp">Status:</i>
                                                                </p>
                                                                <p class="fp"  id="status_name"> <% let status=leave.status %>
                                                    
                                                                    <% if(status=='approved' ){%>
                                                    
                                                                        <span style="color: green"><b>Approved</b> <i
                                                                                class="fa fa-thumbs-o-up"></i></span>
                                                                        <% } %>
                                                                            <% if(status=='rejected' ){%>
                                                    
                                                                                <span style="color: #aa0505"><b>Declined </b><i
                                                                                        class="fa fa-thumbs-o-down"></i></span>
                                                                                <% } %>
                                                                                    <% if(status=='pending' ){%>
                                                                                        <span
                                                                                            style="color: #f29339"><b>Pending</b>
                                                                                            <i
                                                                                                class="fa fa-spinner"></i></span>
                                                                                        <% } %></p>
                                                                <p class="tp" style="display:none"></p>
                                                            </div>
                                                         </div>
                                                         

                                                         
                                                         <div class="col-md-3">
                                                            <div class="address-hr biography updateFields">
                                                                <p class="head-fp">Admin Remark:
                                                                </p>
                                                                <p class="fp"  id="admin_remark"> <% if(leave.admin_remark=='' ) {%>
                                                    
                                                                    "Waiting for Action"
                                                    
                                                                    <%} else {%>
                                                    
                                                                        <%= leave.admin_remark %>
                                                                            <%}%></p>
                                                                <p class="tp" style="display:none"></p>
                                                            </div>
                                                         </div>
                                                         <div class="col-md-3">
                                                            <div class="address-hr biography updateFields">
                                                                <p class="head-fp">Admin Action On:
                                                                </p>
                                                                <p class="fp"  id="admin_action"><% if(leave.admin_remark_date == null ) {%>
                                                    
                                                                    NA
                                                    
                                                                    <%} else {%>
                                                                        <%= leave.admin_remark_date %>
                                                    
                                                                            <%}%></p>
                                                                <p class="tp" style="display:none"></p>
                                                            </div>
                                                         </div>
                                                         <div class="col-md-12">
                                                            <div class="address-hr biography updateFields">
                                                                <p class="head-fp">Leave Conditions:
                                                                </p>
                                                                <p class="fp leave_description"  style="text-align: justify;" id="description"
                                                                value="<%= leave.Description %>"
                                                                id="leave_description"><%= leave.Description %> </p>
                                                                <p class="tp" style="display:none"></p>
                                                            </div>
                                                         </div>

                                                         <% if(url == 1) {%>
                                                            <div>
                                                               <div>
                                                                   <p class="head-fp" style="padding-top: 8px;">Documents
                                                                   </p>
                                                                   <div class="fp" id="documents"
                                                                  
                                                                   id="leave_description">
                                                                   <div class="image-container-file-upload">
                                                                   
                                                                   <!-- <%= leave.document_urls %> -->

                                                                   <% documentNames=leave.document_urls.split(',') %>

                                                                    <% documentNames.forEach(name=>{ %>
                                                                       
 
                                                                        <% lastDotIndex = name.lastIndexOf('.') %>
                                                                        <% parts = name.substring(lastDotIndex + 1) %>
                                                                        <% extension=parts %>
                                                                        <% if( extension == 'jpeg'  || extension == 'jpg'){%>
                                                                           <a href="https://hr.shiftwave.com/assets/uploads/<%=name.trim() %>" target="_blank" ><p><img src="https://hr.shiftwave.com/assets/uploads/<%=name.trim() %>"></p></a>
                                                                            <%}%>
                                                                            <% if( extension == 'pdf' ){%>
                                                                                <a href="https://hr.shiftwave.com/assets/uploads/<%=name.trim() %>" target="_blank" ><p><img src="https://hr.shiftwave.com/assets/images/pdf_icon.png"></p></a>
                                                                                 <%}%>

                                                                                 <% if( extension == 'png' ){%>
                                                                                    <a href="https://hr.shiftwave.com/assets/uploads/<%= name.trim() %>" target="_blank" ><p><img src="https://hr.shiftwave.com/assets/uploads/<%=name.trim() %>"></p></a>
                                                                                     <%}%>

                                                                                     <% if(extension == 'doc' || extension == 'xlxs' || extension == 'xls' || extension == 'docx' || extension == 'txt'){ %>
                                                                                        <a href="https://hr.shiftwave.com/assets/uploads/<%=name.trim() %>" download><p><img src="https://hr.shiftwave.com/assets/images/word-doc-icn.png"></p></a>
                                                                                 <%}%>
                                                                    <% }) %>

                                                                    </div>
                                                                    </div>
                                                               
                                                                        </div>
                                                                  
                                                               </div>
                                                            </div>
                                                            <% } %>

                                                            <div style="padding: 10px 0px;"></div>
                                                            
                                                    
                                                       </div>

                                                                             

                                                        <div>

                                                            <div id="set_action_button">
                                                                <% if(status=='pending' || status=='rejected'){ %>
                                                                    <button type="button" class="btn btn-primary set-button-action1 btn-sm waves-effect waves-light"
                                                                        data-toggle="modal"
                                                                        data-target="#exampleModal">SET
                                                                        ACTION</button>

                                                                    <% } %>



                                                                        <!-- Modal -->
                                                                        <div class="modal fade" id="exampleModal"
                                                                            tabindex="-1" role="dialog"
                                                                            aria-labelledby="exampleModalLabel"
                                                                            aria-hidden="true">
                                                                            <div class="modal-dialog"
                                                                                role="document">
                                                                                <div class="modal-content">
                                                                                    <div class="modal-header">
                                                                                        <h5 class="modal-title set-button-action1"
                                                                                            id="exampleModalLabel">
                                                                                            SET ACTION</h5>
                                                                                        <button type="button"
                                                                                            class="close"
                                                                                            data-dismiss="modal"
                                                                                            aria-label="Close" style="border: none;background-color: white;">
                                                                                            <span
                                                                                                aria-hidden="true">&times;</span>
                                                                                        </button>
                                                                                    </div>

                                                                                    <form name="adminaction">
                                                                                        <div class="modal-body">

                                                                                            <select
                                                                                                class="custom-select form-control"
                                                                                                name="status"
                                                                                                required=""
                                                                                                style="margin-bottom: -12px; border: rgb(230, 230, 230) 0.1px solid;outline: unset;color: grey;padding-left: 10px;">
                                                                                                <option value="">
                                                                                                    Choose...
                                                                                                </option>
                                                                                                <option
                                                                                                    value="approved">
                                                                                                    Approve</option>
                                                                                                <option
                                                                                                    value="rejected">
                                                                                                    Decline</option>
                                                                                            </select><br>
                                                                                            <div class="alert alert-danger alert-dismissible fade show"
                                                                                                style="display: none;"
                                                                                                id="custom-select">
                                                                                                <strong> </strong>
                                                                                            </div>
                                                                                            <br>
                                                                                            <p><textarea
                                                                                                    id="textarea1"
                                                                                                    class="form-control"
                                                                                                    name="description"
                                                                                                    placeholder="Description"
                                                                                                    row="5"
                                                                                                    maxlength="500"
                                                                                                    required></textarea> </p>
                                                                                                    <div class="alert alert-danger alert-dismissible fade show"
                                                                                                    style="display: none;"
                                                                                                    id="text1">
                                                                                                    <strong> </strong>
                                                                                                </div>
                                                                                            
                                                                                             </div>
                                                                                        <div class="modal-footer">
                                                                                            <button type="button"
                                                                                                class="btn btn-danger btn-sm waves-effect waves-light"  id="close"
                                                                                                data-dismiss="modal">Close</button>
                                                                                            <button type="submit"
                                                                                                class="btn btn-primary btn-sm waves-effect waves-light"
                                                                                                id="apply"
                                                                                                name="update">Apply</button>
                                                                                        </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>

                                                                    </div>

                                                        </div>

                                                       

                                                        <% }) %>
                                              
                                                    
                                                
                                                </tbody>
                                                
                                                <% } else{  %>
                                                    <% result.forEach(leave=> { %>


                                                   <div class="row">
                                                    <div class="col-md-3">
                                                        <div class="address-hr biography updateFields">
                                                            <p class="head-fp">Permission Id: </p>
                                                            <p class="sp"  id="permission_id"><%= leave.permission_id %> </p>
                                                            <p class="tp" style="display:none"> </p>
                                                        </div>
                                                     </div>
                                                    <div class="col-md-3">
                                                        <div class="address-hr biography updateFields">
                                                            <p class="head-fp">Employee Name: </p>
                                                            <p class="sp" id="employee_name"><%= leave.fullname %> </p>
                                                            <p class="tp" style="display:none"> </p>
                                                       </div>                               
                                                    </div>
                                                    
                                                    <div class="col-md-3">
                                                        <div class="address-hr biography updateFields">
                                                            <p class="head-fp">Employee Email:
                                                            </p>
                                                            <p class="sp" id="email"> <%= leave.email %></p>
                                                            <p class="tp" style="display:none"></p>
                                                        </div>
                                                     </div>
                                                     <div class="col-md-3">
                                                        <div class="address-hr biography updateFields">
                                                            <p class="head-fp">Employee id:
                                                            </p>
                                                            <p class="sp"  id="employee_id"> <a
                                                                
                                                                target="_blank">
                                                                <%= leave.employee_id %>
                                                            </a></p>
                                                            <p class="tp" style="display:none"></p>
                                                        </div>
                                                     </div>
                                                     <div class="col-md-3">
                                                        <div class="address-hr biography updateFields">
                                                            <p class="head-fp">Permission Date:
                                                            </p>
                                                            <p class="fp permission_date" id="updateShow-119">   <%= leave.date.getDate() %>/<%=
                                                                (leave.date.getMonth() +
                                                                1).toString().padStart(2, '0' ) %>/<%=
                                                                    leave.date.getFullYear() %></p>
                                                            <p class="tp" style="display:none"></p>
                                                        </div>
                                                     </div>
                                                     <div class="col-md-3">
                                                        <div class="address-hr biography updateFields">
                                                            <p class="head-fp">Permission From:
                                                            </p>
                                                            <p class="fp from_date"  id="updateShow-119" class=""> <%= leave.start_time %></p>
                                                            <p class="tp" style="display:none"></p>
                                                        </div>
                                                     </div>
                                                     
                                                    
                                                     <div class="col-md-3">
                                                        <div class="address-hr biography updateFields">
                                                            <p class="head-fp">Permission Upto:
                                                            </p>
                                                            <p class="fp to_date" id="updateShow-119"> <%= leave.end_time %></p>
                                                            <p class="tp" style="display:none"></p>
                                                        </div>
                                                     </div>
                                                     <div class="col-md-3">
                                                        <div class="address-hr biography updateFields">
                                                            <p class="head-fp">Permission Applied:
                                                            </p>
                                                            <p class="fp" ><% const date=new Date(leave.created_at); const
                                                                formattedDate=`${date.getDate().toString().padStart(2, '0'
                                                                )}/${(date.getMonth()
                                                                    + 1).toString().padStart(2, '0'
                                                                    )}/${date.getFullYear()}
                                                                `; %>
                                                                <%= formattedDate %></p>
                                                            <p class="tp" style="display:none"></p>
                                                        </div>
                                                     </div>
                                                     <div class="col-md-3">
                                                        <div class="address-hr biography updateFields">
                                                            <p class="head-fp">Status:</i>
                                                            </p>
                                                            <p class="fp"  id="status_name"> <% let status=leave.status %>
                                                    
                                                                <% if(status=='approved' ){%>
                                                    
                                                                    <span style="color: green"><b>Approved</b> <i
                                                                            class="fa fa-thumbs-o-up"></i></span>
                                                                    <% } %>
                                                                        <% if(status=='rejected' ){%>
                                                    
                                                                            <span style="color: #aa0505"><b>Declined</b> <i
                                                                                    class="fa fa-thumbs-o-down"></i></span>
                                                                            <% } %>
                                                                                <% if(status=='pending' ){%>
                                                                                    <span
                                                                                        style="color: #f29339"><b>Pending</b>
                                                                                        <i
                                                                                            class="fa fa-spinner"></i></span>
                                                                                    <% } %></p>
                                                            <p class="tp" style="display:none"></p>
                                                        </div>
                                                     </div>
                                                     
                                                     <div class="col-md-3">
                                                        <div class="address-hr biography updateFields">
                                                            <p class="head-fp">Admin Remark:
                                                            </p>
                                                            <p class="fp"  id="admin_remark"><% if(leave.admin_remark_permission =='' ) {%>
                                                    
                                                                "Waiting for Action"
                                                    
                                                                <%} else {%>
                                                    
                                                                    <%= leave.admin_remark_permission %>
                                                                        <%}%></p>
                                                            <p class="tp" style="display:none"></p>
                                                        </div>
                                                     </div>
                                                     <div class="col-md-3">
                                                        <div class="address-hr biography updateFields">
                                                            <p class="head-fp">Admin Action On:
                                                            </p>
                                                            <p class="fp"  id="admin_action"> <% if(leave.admin_remark_date_permission == null ) {%>
                                                    
                                                                "NA"
                                                    
                                                                <%} else {%>
                                                                    <%= leave.admin_remark_date_permission	 %>
                                                    
                                                                        <%}%></p>
                                                                      
                                                            <p class="tp" style="display:none"></p>
                                                        </div>
                                                     </div>
                                                     <div class="col-md-12">
                                                        <div class="address-hr biography updateFields">
                                                            <p class="head-fp">Permission Conditions:
                                                            </p>
                                                            <p class="fp leave_description"  id="admin_action"> <%= leave.reason %></p>
                                                                      
                                                            <p class="tp" style="display:none"></p>
                                                        </div>
                                                     </div>
                                                     <div class="address-hr biography updateFields" style="margin-top: -17px;margin-bottom: 30px;"></div>

                                                   </div>



                                                            <div>

                                                                <div id="set_action_button">
                                                                    <% if(status=='pending' ||  status=='rejected' ){ %>
                                                                        <button type="button" class="btn btn-primary set-button-action1 btn-sm waves-effect waves-light"
                                                                            data-toggle="modal"
                                                                            data-target="#exampleModal">SET
                                                                            ACTION</button>

                                                                        <% } %>



                                                                            <!-- Modal -->
                                                                            <div class="modal fade" id="exampleModal"
                                                                                tabindex="-1" role="dialog"
                                                                                aria-labelledby="exampleModalLabel"
                                                                                aria-hidden="true">
                                                                                <div class="modal-dialog"
                                                                                    role="document">
                                                                                    <div class="modal-content">
                                                                                        <div class="modal-header">
                                                                                            <h5 class="modal-title set-button-action1"
                                                                                                id="exampleModalLabel">
                                                                                                SET ACTION</h5>
                                                                                            <button type="button"
                                                                                                class="close"
                                                                                                data-dismiss="modal"
                                                                                                aria-label="Close" style="border: none;background-color: white;">
                                                                                                <span
                                                                                                    aria-hidden="true">&times;</span>
                                                                                            </button>
                                                                                        </div>

                                                                                        <form name="adminaction">
                                                                                            <div class="modal-body">

                                                                                                <select
                                                                                                    class="custom-select form-control"
                                                                                                    name="status"
                                                                                                    required=""
                                                                                                style="margin-bottom: -12px;border: rgb(230, 230, 230) 0.1px solid;outline: unset;color: grey;padding-left: 10px;">

                                                                                                >
                                                                                                    <option value="">
                                                                                                        Choose...
                                                                                                    </option>
                                                                                                    <option
                                                                                                        value="approved">
                                                                                                        Approved</option>
                                                                                                    <option
                                                                                                        value="rejected">
                                                                                                        Declined</option>
                                                                                                </select><br>
                                                                                                <div class="alert alert-danger alert-dismissible fade show"
                                                                                                    style="display: none;"
                                                                                                    id="custom-select">
                                                                                                    <strong> </strong>
                                                                                                </div>
                                                                                                <br>
                                                                                                <p><textarea
                                                                                                        id="textarea1"
                                                                                                        class="form-control"
                                                                                                        name="description"
                                                                                                        placeholder="Description"
                                                                                                        row="5"
                                                                                                        maxlength="500"
                                                                                                        ></textarea>
                                                                                             
                                                                                                </p>
                                                                                                <div class="alert alert-danger alert-dismissible fade show"
                                                                                                    style="display: none;"
                                                                                                    id="text1">
                                                                                            </div>
                                                                                            <div class="modal-footer">
                                                                                                <button type="button"
                                                                                                    class="btn btn-danger btn-sm waves-effect waves-light" id="Permission_close"
                                                                                                    data-dismiss="modal">Close</button>
                                                                                                <button type="submit"
                                                                                                    class="btn btn-primary btn-sm waves-effect waves-light"
                                                                                                    id="apply"
                                                                                                    name="update">Apply</button>
                                                                                            </div>
                                                                                             </form>
                                                                                    </div>
                                                                                </div>
                                                                            </div>

                                                                        </div>

                                                            </div>
                                                    <% }) %>
                                                    
                                                  <% } %>
                                                </div>  
                                            </table>
                                        
                                    
                                </div>
                            </div>
                        </div>
                        <!-- Striped table end -->

                    </div>


                </div> <!-- container -->

            </div> <!-- content -->

            <!-- <% result.forEach(leave => { %>
                <%= leave.document_urls %>
            <% }) %> -->
            

            <!-- Footer Start -->
            <%- include('../includes/employee-footer')%>
            <!-- end Footer -->
          


        </div>

        <!-- ============================================================== -->
        <!-- End Page content -->
        <!-- ============================================================== -->

</div>

<!-- END wrapper -->
    <!-- END wrapper -->

    <!-- Theme Settings -->
   
    <%- include('../includes/admin-theme-settings')%>

        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

        <!-- Vendor js -->
        <script src="/assets/js/vendor.min.js"></script>

        <!-- App js -->
        <script src="/assets/js/app.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

        <!-- Vendor js -->
        <script src="/assets/js/vendor.min.js"></script>

        <!-- Datatables js -->
        <script src="/assets/vendor/datatables.net/js/jquery.dataTables.min.js"></script>
        <script src="/assets/vendor/datatables.net-bs5/js/dataTables.bootstrap5.min.js"></script>
      
        <!-- Datatable Demo Aapp js -->
        <script src="/assets/js/pages/datatable.init.js"></script>

        <!-- App js -->
        <script src="/assets/js/app.min.js"></script>





        <script>

            $(document).ready(function () {
                $('.delete_button').on('click', function () {
                    const reqIdValue = $('#req_id').text().trim(); // Get and trim request_id value
                    const perIdValue = $('#permission_id').text().trim(); // Get and trim permission_id value

                    if (confirm('Are you sure you want to proceed?')) {
                        if (reqIdValue || perIdValue) {
                            const dataToSend = {}; // Initialize an empty object for data

                            if (reqIdValue) {
                                dataToSend.request_id = reqIdValue;
                            }

                            if (perIdValue) {
                                dataToSend.permission_id = perIdValue;
                            }

                            $.ajax({
                                url: '/leave/deleteLeave',
                                type: 'POST',
                                data: dataToSend, 
                                success: function (response) {
                                    alert(response.message); 
                                },
                                error: function (xhr, status, error) {
                                    alert('Error: ' + error); 
                                }
                            });
                        } else {
                            alert('No valid ID found to delete!');
                        }
                    } else {
                        alert('Action cancelled!');
                    }
                });

                $('.custom-select').on('change', function () {
                        $('#custom-select').hide();
                        $('#textarea1').on('input', function () {
                            $('#textarea-error').hide();
                         });

                
                });      

                $('#apply').on('click', function (event) {
                    event.preventDefault();

                    let status = $('.custom-select').val();
                    let description = $('#textarea1').val();
                    let request_id = $('#req_id').text();
                    let  permission_id = $('#permission_id').text();
                    let  days= $("#days").text().trim();
                    let employee_name=$('#employee_name').text().trim();              
                    let email=$('#email').text().trim();
                    let from_date = $('.from_date').text().trim();
                    let to_date = $('.to_date').text().trim();
                    let leave_description = $(".leave_description").text().trim();
                    let permission_date = $(".permission_date").text().trim();
                  
                        
                  
                    if (status == 'rejected') {
                         mail_status = 'Declined'
                     }
                    if(status == 'approved') {
                        mail_status = 'Approved'
                    }
                    if (status === '') {
                     $('#custom-select').text("Please select an option from the list");
                     $('#custom-select').show();
                    } else {
                        $('#custom-select').hide();
                    }
                    if (status !== '' )  {

                        $.ajax({
                            type: 'POST',
                            dataType: "json",
                            data: {
                                status: status,
                                description: description,
                                request_id: request_id,
                                permission_id:permission_id,
                                days:days,
                                employee_name:employee_name,
                                email:email,
                                mail_status:mail_status,
                                from_date:from_date,
                                to_date:to_date,
                                leave_description:leave_description,
                                permission_date:permission_date
                            },
                            url: '/leave/updateLeaveStatus',
                            success: function (response) {
                                if (response.status === 'failed') {
                                    window.location.href = "/employees/leave";
                                } else {
                                    event.preventDefault();
                                    
                                    $('html, body').animate({ scrollTop: 0 }, 'slow');
                                   
                                    if (status != 'rejected') {
                                    
                                    $('#exampleModal').modal('hide');
                                    $('body').removeClass('modal-open');
                                    $('.modal-backdrop').remove();
                                    $("#leave_description").load(window.location.href + " #leave_description");

                                    $("#set_action_button").load(window.location.href + " #set_action_button");
                                    $("#admin_remark").load(window.location.href + " #admin_remark");
                                    $("#admin_action").load(window.location.href + " #admin_action");
                                    $("#status_name").load(window.location.href + " #status_name");
                                    $('#sucess_message').text("Updated Successfully");

                                    $('#sucess_message').show().fadeIn().delay(2000).fadeOut();
                                  
                                    $('.custom-select').val('');
                                    $('#textarea1').val('');
                                    }else{

                                    

                                        $('#close').click();
                                        $('#Permission_close').click();
                                        $('.custom-select').val('');
                                        $('#textarea1').val('');
                                        $("#admin_remark").load(window.location.href + " #admin_remark");
                                        $("#status_name").load(window.location.href + " #status_name");
                                        $("#admin_action").load(window.location.href + " #admin_action");
                                        $('#sucess_message').text("Leave updated Successfully").show().fadeIn().delay(2000).fadeOut();;
                                        


                                    }
                                    


                                }
                            }
                        });
                   
                    }
               
                });
            });




        </script>
        <!-- Vendor js -->
        <script src="/assets/js/vendor.min.js"></script>

        <!-- App js -->
        <script src="/assets/js/app.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>



</body>

</html>